<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Prayer Journey</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Noto+Sans+Arabic:wght@300;400;500;700&display=swap');
        
        :root {
            --primary: #1f4e5f;
            --primary-light: #2c6d7c;
            --primary-dark: #113945;
            --accent: #c8a45c;
            --accent-light: #d9bd85;
            --accent-dark: #ab8539;
            --text-light: #f7f7f7;
            --text-dark: #333333;
            --background: #f4f1ea;
            --card-bg: #ffffff;
            --prayer-bg: rgba(200, 164, 92, 0.1);
            --prayer-completed: rgba(76, 175, 80, 0.7);
            --prayer-missed: rgba(244, 67, 54, 0.3);
            --prayer-pending: rgba(255, 152, 0, 0.3);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans Arabic', 'Amiri', serif;
            background-color: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M15,30 Q30,5 50,30 T85,30 Q95,10 85,50 T85,70 Q70,95 50,70 T15,70 Q5,90 15,50 T15,30" stroke="%23c8a45c" fill="none" stroke-width="0.5" opacity="0.3" /></svg>');
            background-size: 300px;
            background-repeat: repeat;
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: var(--transition);
        }
        
        .overlay.active {
            visibility: visible;
            opacity: 1;
        }
        
        .login-panel {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-panel h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .welcome-box {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .welcome-box .bismillah {
            color: var(--accent);
            font-family: 'Amiri', serif;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .welcome-box .translation {
            font-style: italic;
            color: var(--text-dark);
            opacity: 0.7;
            margin-bottom: 1.5rem;
        }

        header {
            background-color: var(--primary);
            color: var(--text-light);
            padding: 2rem 0;
            text-align: center;
            box-shadow: var(--shadow);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M15,30 Q30,5 50,30 T85,30 Q95,10 85,50 T85,70 Q70,95 50,70 T15,70 Q5,90 15,50 T15,30" stroke="%23ffffff" fill="none" stroke-width="0.5" opacity="0.1" /></svg>');
            background-size: 200px;
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        h1 {
            margin: 0;
            font-size: 2.5rem;
            font-family: 'Amiri', serif;
            font-weight: 700;
        }
        
        .header-subtitle {
            margin-top: 0.5rem;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .header-quote {
            font-style: italic;
            margin-top: 1rem;
            font-family: 'Amiri', serif;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            padding: 0.5rem 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: var(--accent);
            color: var(--text-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-size: 1.2rem;
        }
        
        .user-name {
            font-weight: 500;
        }

        .tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .tab {
            flex: 1;
            padding: 1rem;
            background-color: var(--card-bg);
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            color: var(--text-dark);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--accent);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .tab.active {
            color: var(--primary);
            background-color: rgba(31, 78, 95, 0.05);
        }

        .tab.active::after {
            transform: scaleX(1);
        }

        .tab:hover:not(.active) {
            background-color: rgba(31, 78, 95, 0.02);
        }

        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .islamic-date {
            text-align: center;
            margin-bottom: 2rem;
            font-family: 'Amiri', serif;
            color: var(--primary);
        }

        .date-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            background-color: var(--card-bg);
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .date-selector label {
            margin-right: 1rem;
            font-weight: 500;
            color: var(--primary);
        }

        .date-selector input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: var(--background);
            font-family: inherit;
        }

        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .prayer-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .prayer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--prayer-bg);
            z-index: 0;
        }

        .prayer-card.completed::before {
            background-color: var(--prayer-completed);
        }

        .prayer-card.missed::before {
            background-color: var(--prayer-missed);
        }

        .prayer-card.pending::before {
            background-color: var(--prayer-pending);
        }

        .prayer-card-content {
            position: relative;
            z-index: 1;
        }

        .prayer-icon {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: block;
            text-align: center;
        }

        .prayer-name {
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
            text-align: center;
        }

        .prayer-arabic {
            font-family: 'Amiri', serif;
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .prayer-time {
            color: var(--text-dark);
            opacity: 0.7;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .prayer-status {
            display: flex;
            justify-content: space-around;
            margin-top: 1rem;
        }

        .status-btn {
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            margin: 0 0.25rem;
            font-weight: 500;
            text-align: center;
        }

        .status-btn.completed {
            color: #2e7d32;
        }

        .status-btn.missed {
            color: #c62828;
        }

        .status-btn.active {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .status-btn:hover:not(.active) {
            background-color: rgba(200, 164, 92, 0.1);
        }

        .user-profiles {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .profile-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .profile-card.active {
            border-color: var(--accent);
            background-color: rgba(200, 164, 92, 0.05);
        }

        .profile-card:hover:not(.active) {
            transform: translateY(-5px);
        }

        .profile-avatar {
            width: 70px;
            height: 70px;
            background-color: var(--primary);
            color: var(--text-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
        }

        .profile-name {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .profile-detail {
            color: var(--text-dark);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        .message-form {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .message-form textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 1rem;
            font-family: inherit;
            background-color: var(--background);
        }

        .message-form button {
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            margin-left: auto;
        }

        .message-form button i {
            margin-right: 0.5rem;
        }

        .message-form button:hover {
            background-color: var(--accent-dark);
        }

        .messages-container {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .message {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            align-items: center;
        }

        .message-sender {
            display: flex;
            align-items: center;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            background-color: var(--primary);
            color: var(--text-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-size: 1rem;
        }

        .message-name {
            font-weight: 500;
        }

        .message-time {
            color: var(--text-dark);
            opacity: 0.7;
            font-size: 0.85rem;
        }

        .message-content {
            line-height: 1.7;
        }

        .message-actions {
            margin-top: 1rem;
            display: flex;
            justify-content: flex-end;
        }

        .message-delete {
            color: #c62828;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: var(--transition);
        }

        .message-delete:hover {
            background-color: rgba(198, 40, 40, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .stats-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
        }

        .stats-title {
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }

        .stats-title i {
            margin-right: 0.75rem;
            color: var(--accent);
        }

        .stats-value {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 700;
            color: var(--accent);
        }

        .progress-bar {
            height: 10px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .stats-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            text-align: center;
        }

        .stats-detail {
            padding: 0.5rem;
            border-radius: 6px;
        }

        .stats-detail.completed {
            background-color: rgba(76, 175, 80, 0.1);
        }

        .stats-detail.missed {
            background-color: rgba(244, 67, 54, 0.1);
        }

        .stats-detail.pending {
            background-color: rgba(255, 152, 0, 0.1);
        }

        .stats-label {
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
            color: var(--text-dark);
            opacity: 0.7;
        }

        .stats-number {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .settings-form {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--primary);
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            background-color: var(--background);
        }

        .settings-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .settings-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .settings-save {
            background-color: var(--accent);
            color: white;
            border: none;
        }

        .settings-save:hover {
            background-color: var(--accent-dark);
        }

        .settings-cancel {
            background-color: transparent;
            color: var(--text-dark);
            border: 1px solid #ddd;
        }

        .settings-cancel:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }
        
        .loading i {
            font-size: 2rem;
            color: var(--accent);
            animation: spin 1.5s linear infinite;
        }
        
        .loading p {
            margin-top: 1rem;
            color: var(--primary);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--card-bg);
            color: var(--text-dark);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 100;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification i {
            margin-right: 0.75rem;
            font-size: 1.2rem;
        }

        .notification.success i {
            color: #4caf50;
        }

        .notification.error i {
            color: #f44336;
        }

        @media (max-width: 768px) {
            .prayer-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .user-profiles {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 1 calc(50% - 0.5rem);
                text-align: center;
                margin-bottom: 0.5rem;
            }
            
            .stats-details {
                grid-template-columns: 1fr;
            }
            
            .date-selector {
                flex-direction: column;
                align-items: stretch;
            }
            
            .date-selector label {
                margin-right: 0;
                margin-bottom: 0.5rem;
            }
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--primary);
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
        }
        
        .btn {
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            width: 100%;
            margin-top: 1rem;
        }
        
        .btn:hover {
            background-color: var(--accent-dark);
        }
        
        .auth-links {
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .auth-links a {
            color: var(--accent);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .auth-links a:hover {
            color: var(--accent-dark);
            text-decoration: underline;
        }
        
        .couple-id-container {
            margin-top: 2rem;
            padding: 1rem;
            background-color: rgba(200, 164, 92, 0.1);
            border-radius: 6px;
            text-align: center;
        }
        
        .couple-id-container p {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .couple-id {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
            font-family: monospace;
            padding: 0.5rem;
            background-color: rgba(31, 78, 95, 0.05);
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 1rem;
        }
        
        .copy-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .copy-btn:hover {
            background-color: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="overlay" id="login-overlay">
        <div class="login-panel">
            <div class="welcome-box">
                <div class="bismillah">بِسْمِ اللهِ الرَّحْمٰنِ الرَّحِيْمِ</div>
                <div class="translation">In the name of Allah, the Most Gracious, the Most Merciful</div>
            </div>
            <h2>Join Your Prayer Journey</h2>
            <div id="login-form">
                <div class="input-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="your@email.com">
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Password">
                </div>
                <button class="btn" id="login-btn">Sign In</button>
                <div class="auth-links">
                    <p>Don't have an account? <a href="#" id="show-signup">Create one</a></p>
                </div>
            </div>
            <div id="signup-form" style="display: none;">
                <div class="input-group">
                    <label for="signup-name">Your Name</label>
                    <input type="text" id="signup-name" placeholder="Your name">
                </div>
                <div class="input-group">
                    <label for="partner-name">Partner's Name</label>
                    <input type="text" id="partner-name" placeholder="Your partner's name">
                </div>
                <div class="input-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" placeholder="your@email.com">
                </div>
                <div class="input-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" placeholder="Password">
                </div>
                <button class="btn" id="signup-btn">Create Account</button>
                <div class="couple-id-container" id="couple-container" style="display: none;">
                    <p>Share this code with your partner to connect:</p>
                    <div class="couple-id" id="couple-id"></div>
                    <button class="copy-btn" id="copy-btn">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                <div class="input-group" id="join-container" style="display: none;">
                    <label for="join-code">Or enter your partner's code:</label>
                    <input type="text" id="join-code" placeholder="Enter code here">
                    <button class="btn" id="join-btn" style="background-color: var(--primary);">Join Partner</button>
                </div>
                <div class="auth-links">
                    <p>Already have an account? <a href="#" id="show-login">Sign in</a></p>
                </div>
            </div>
        </div>
    </div>

    <header>
        <div class="container">
            <div class="header-content">
                <h1>Our Prayer Journey</h1>
                <p class="header-subtitle">Supporting each other on the path to Allah</p>
                <p class="header-quote">"My success is only by Allah." — Quran 11:88</p>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="user-info">
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-name" id="current-user-name">Welcome</div>
            </div>
            <button id="logout-btn" class="status-btn" style="max-width: 100px;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <div class="islamic-date" id="islamic-date">
            Loading Islamic date...
        </div>

        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'prayers')">
                <i class="fas fa-pray"></i> Prayers
            </button>
            <button class="tab" onclick="openTab(event, 'messages')">
                <i class="fas fa-heart"></i> Messages
            </button>
            <button class="tab" onclick="openTab(event, 'stats')">
                <i class="fas fa-chart-bar"></i> Statistics
            </button>
            <button class="tab" onclick="openTab(event, 'settings')">
                <i class="fas fa-cog"></i> Settings
            </button>
        </div>

        <div id="prayers" class="tab-content active">
            <div class="user-profiles">
                <div class="profile-card active" id="user-profile" onclick="selectUserProfile('user')">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-name" id="user-profile-name">Your Name</div>
                    <div class="profile-detail">Your prayers</div>
                </div>
                <div class="profile-card" id="partner-profile" onclick="selectUserProfile('partner')">
                    <div class="profile-avatar">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="profile-name" id="partner-profile-name">Partner's Name</div>
                    <div class="profile-detail">Partner's prayers</div>
                </div>
            </div>

            <div class="date-selector">
                <label>Select Date:</label>
                <input type="date" id="date-picker" onchange="loadPrayerData()">
            </div>

            <div id="prayer-container" class="prayer-grid">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Loading prayer data...</p>
                </div>
            </div>
        </div>

        <div id="messages" class="tab-content">
            <div class="message-form">
                <textarea id="message-input" placeholder="Write a loving message for your partner..."></textarea>
                <button onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i> Send Message
                </button>
            </div>

            <div id="messages-container" class="messages-container">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Loading messages...</p>
                </div>
            </div>
        </div>

        <div id="stats" class="tab-content">
            <div class="user-profiles">
                <div class="profile-card active" id="stats-user-profile" onclick="selectStatsProfile('user')">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-name" id="stats-user-name">Your Name</div>
                    <div class="profile-detail">Your statistics</div>
                </div>
                <div class="profile-card" id="stats-partner-profile" onclick="selectStatsProfile('partner')">
                    <div class="profile-avatar">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="profile-name" id="stats-partner-name">Partner's Name</div>
                    <div class="profile-detail">Partner's statistics</div>
                </div>
            </div>

            <div class="date-selector">
                <label>Time Period:</label>
                <select id="stats-period-selector" onchange="loadUserStats()">
                    <option value="7">Last 7 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="90">Last 90 days</option>
                </select>
            </div>

            <div id="stats-container" class="stats-grid">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Loading statistics...</p>
                </div>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="settings-form">
                <div class="form-group">
                    <label for="user-name-input">Your Name</label>
                    <input type="text" id="user-name-input" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="partner-name-input">Partner's Name</label>
                    <input type="text" id="partner-name-input" placeholder="Enter your partner's name">
                </div>
                <div class="couple-id-container">
                    <p>Your couple connection ID:</p>
                    <div class="couple-id" id="settings-couple-id">Loading...</div>
                    <button class="copy-btn" id="settings-copy-btn">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                <div class="settings-buttons">
                    <button class="settings-btn settings-cancel" onclick="cancelSettings()">Cancel</button>
                    <button class="settings-btn settings-save" onclick="saveSettings()">Save Changes</button>
                </div>
                <div class="form-group">
                    <label for="join-code">Join Existing Couple</label>
                    <div class="join-container" style="display: flex; gap: 0.5rem; margin-top: 0.5rem; width: 100%;">
                        <!-- In Settings tab -->
                         <input type="text" id="settings-join-code" placeholder="Enter partner's code">
                        <button class="btn" onclick="joinCouple()" 
                                style="background-color: var(--primary); padding: 0.75rem 1.5rem; 
                                       white-space: nowrap; min-width: 120px;">
                            Join Partner
                        </button>
                    </div>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-dark);">
                        Enter your partner's 6-digit code to connect accounts
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Operation successful</span>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.20.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.20.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.20.0/firebase-database-compat.min.js"></script>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            // You will need to replace these with your own Firebase project credentials
            apiKey: "AIzaSyBw5mBTSeWSCWIIq_NaW-vd24XLEyppzCQ",
            authDomain: "siyan-b2159.firebaseapp.com",
            databaseURL: "https://siyan-b2159-default-rtdb.firebaseio.com",
            projectId: "siyan-b2159",
            storageBucket: "siyan-b2159.firebasestorage.app",
            messagingSenderId: "1090138535675",
            appId: "1:1090138535675:web:e2a606d170bc3ee89a225e"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Get references to Firebase services
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Prayer data structure
        const prayers = [
            { id: 'fajr', name: 'Fajr', arabicName: 'الفجر', time: 'Dawn', icon: 'fa-sun' },
            { id: 'dhuhr', name: 'Dhuhr', arabicName: 'الظهر', time: 'Noon', icon: 'fa-sun' },
            { id: 'asr', name: 'Asr', arabicName: 'العصر', time: 'Afternoon', icon: 'fa-sun' },
            { id: 'maghrib', name: 'Maghrib', arabicName: 'المغرب', time: 'Sunset', icon: 'fa-moon' },
            { id: 'isha', name: 'Isha', arabicName: 'العشاء', time: 'Night', icon: 'fa-moon' }
        ];
        
        // App state
        let appState = {
            currentUser: null,
            userId: null,
            userName: '',
            partnerName: '',
            coupleId: null,
            selectedProfile: 'user', // 'user' or 'partner'
            selectedStatsProfile: 'user' // 'user' or 'partner'
        };
        
        // DOM elements
        const loginOverlay = document.getElementById('login-overlay');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const showSignupLink = document.getElementById('show-signup');
        const showLoginLink = document.getElementById('show-login');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const notificationEl = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', initializeApp);
        showSignupLink.addEventListener('click', showSignup);
        showLoginLink.addEventListener('click', showLogin);
        loginBtn.addEventListener('click', loginUser);
        signupBtn.addEventListener('click', signupUser);
        logoutBtn.addEventListener('click', logoutUser);
        document.getElementById('date-picker').valueAsDate = new Date();
        
        // Copy buttons
        if (document.getElementById('copy-btn')) {
            document.getElementById('copy-btn').addEventListener('click', () => copyToClipboard('couple-id'));
        }
        if (document.getElementById('settings-copy-btn')) {
            document.getElementById('settings-copy-btn').addEventListener('click', () => copyToClipboard('settings-couple-id'));
        }
        
        // Initialize app
        function initializeApp() {
            // Listen for auth state changes
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    appState.userId = user.uid;
                    loginOverlay.classList.remove('active');
                    loadUserData(user.uid);
                } else {
                    // No user is signed in
                    loginOverlay.classList.add('active');
                }
            });
            
            // Set current date in date picker
            setCurrentDate();
            displayIslamicDate();
        }
        
        // Set current date in date picker
        function setCurrentDate() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('date-picker').value = formattedDate;
        }
        
        // Display Islamic date
        function displayIslamicDate() {
            const today = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                calendar: 'islamic' 
            };
            try {
                const islamicDate = today.toLocaleDateString('ar-SA', options);
                document.getElementById('islamic-date').textContent = islamicDate;
            } catch (error) {
                // Fallback if Islamic calendar is not supported
                document.getElementById('islamic-date').textContent = today.toDateString();
            }
        }
        
        // Show signup form
        function showSignup(e) {
            e.preventDefault();
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
        }
        
        // Show login form
        function showLogin(e) {
            e.preventDefault();
            signupForm.style.display = 'none';
            loginForm.style.display = 'block';
        }
        
        // Login user
        function loginUser() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showNotification('Please enter both email and password.', 'error');
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Logged in successfully
                    showNotification('Logged in successfully!');
                })
                .catch((error) => {
                    showNotification(error.message, 'error');
                });
        }
        
        // Signup user
        function signupUser() {
            const name = document.getElementById('signup-name').value;
            const partnerName = document.getElementById('partner-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            if (!name || !email || !password) {
                showNotification('Please fill in all required fields.', 'error');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const userId = userCredential.user.uid;
                    
                    // Generate a unique couple ID
                    const coupleId = generateCoupleId();
                    
                    // Save user data
                    const userData = {
                        name: name,
                        partnerName: partnerName || 'Partner',
                        email: email,
                        coupleId: coupleId,
                        createdAt: new Date().toISOString()
                    };
                    
                    database.ref('users/' + userId).set(userData)
                        .then(() => {
                            // Create couple entry
                            database.ref('couples/' + coupleId + '/members/' + userId).set(true);
                            
                            // Show couple ID
                            document.getElementById('couple-container').style.display = 'block';
                            document.getElementById('join-container').style.display = 'block';
                            document.getElementById('couple-id').textContent = coupleId;
                            
                            showNotification('Account created successfully!');
                        })
                        .catch((error) => {
                            showNotification('Error saving user data: ' + error.message, 'error');
                        });
                })
                .catch((error) => {
                    showNotification(error.message, 'error');
                });
        }
        
        // Join a couple with code
        document.getElementById('join-btn').addEventListener('click', function() {
            const code = document.getElementById('join-code').value.trim();
            if (!code) {
                showNotification('Please enter a valid code', 'error');
                return;
            }
            
            if (!auth.currentUser) {
                showNotification('Please sign in first', 'error');
                return;
            }
            
            const userId = auth.currentUser.uid;
            
            // Check if code exists
            database.ref('couples/' + code).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        // Add user to couple
                        database.ref('couples/' + code + '/members/' + userId).set(true);
                        
                        // Update user's coupleId
                        database.ref('users/' + userId).update({
                            coupleId: code
                        });
                        
                        showNotification('Successfully joined your partner!');
                        
                        // Reload user data
                        loadUserData(userId);
                    } else {
                        showNotification('Invalid couple code', 'error');
                    }
                })
                .catch((error) => {
                    showNotification('Error: ' + error.message, 'error');
                });
        });
        
        // Generate a unique couple ID
        function generateCoupleId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        // Copy text to clipboard
        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text)
                .then(() => {
                    showNotification('Copied to clipboard!');
                })
                .catch(err => {
                    showNotification('Failed to copy text: ' + err, 'error');
                });
        }
        
        // Logout user
        function logoutUser() {
            auth.signOut()
                .then(() => {
                    showNotification('Logged out successfully!');
                })
                .catch((error) => {
                    showNotification('Error: ' + error.message, 'error');
                });
        }
function joinCouple() {
    const rawCode = document.getElementById('settings-join-code').value;
    const code = rawCode.trim().toUpperCase().replace(/[^A-Z0-9]/g, '');
    
    if (code.length !== 6) {
        showNotification('Code must be exactly 6 characters', 'error');
        return;
    }

    const coupleRef = database.ref('couples/' + code);
    
    coupleRef.child('members').once('value')
    .then((snapshot) => {
        const members = snapshot.val() || {};
        if (Object.keys(members).length >= 2) {
            showNotification('Couple is already full', 'error');
            return;
        }
        
        // Add user to couple members
        return coupleRef.child('members').child(appState.userId).set(true);
    })
    .then(() => {
        // Update user's couple ID
        return database.ref('users/' + appState.userId).update({
            coupleId: code
        });
    })
    .then(() => {
        showNotification('Successfully joined couple!');
        appState.coupleId = code;
        loadUserData(appState.userId);
    })
    .catch((error) => {
        let message = error.message;
        if (error.code === 'PERMISSION_DENIED') {
            message = 'Invalid couple code or insufficient permissions';
        }
        showNotification(message, 'error');
    });
}
        // Load user data
        function loadUserData(userId) {
            database.ref('users/' + userId).once('value')
                .then((snapshot) => {
                    const userData = snapshot.val();
                    
                    if (userData) {
                        appState.userName = userData.name;
                        appState.partnerName = userData.partnerName;
                        appState.coupleId = userData.coupleId;
                        
                        // Update UI
                        document.getElementById('current-user-name').textContent = userData.name;
                        document.getElementById('user-profile-name').textContent = userData.name;
                        document.getElementById('partner-profile-name').textContent = userData.partnerName;
                        document.getElementById('stats-user-name').textContent = userData.name;
                        document.getElementById('stats-partner-name').textContent = userData.partnerName;
                        
                        // Settings
                        document.getElementById('user-name-input').value = userData.name;
                        document.getElementById('partner-name-input').value = userData.partnerName;
                        document.getElementById('settings-couple-id').textContent = userData.coupleId;
                        
                        // Load data
                        loadPrayerData();
                        loadMessages();
                        loadUserStats();
                    }
                })
                .catch((error) => {
                    showNotification('Error loading user data: ' + error.message, 'error');
                });
        }
        
        // Open tab content when tab is clicked
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }

            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }

            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');

            // Refresh content when switching tabs
            if (tabName === 'prayers') {
                loadPrayerData();
            } else if (tabName === 'messages') {
                loadMessages();
            } else if (tabName === 'stats') {
                loadUserStats();
            }
        }
        
        // Select user profile (own or partner's prayers)
        function selectUserProfile(profile) {
            appState.selectedProfile = profile;
            
            // Update UI
            document.getElementById('user-profile').classList.toggle('active', profile === 'user');
            document.getElementById('partner-profile').classList.toggle('active', profile === 'partner');
            
            // Reload prayer data
            loadPrayerData();
        }
        
        // Select stats profile
        function selectStatsProfile(profile) {
            appState.selectedStatsProfile = profile;
            
            // Update UI
            document.getElementById('stats-user-profile').classList.toggle('active', profile === 'user');
            document.getElementById('stats-partner-profile').classList.toggle('active', profile === 'partner');
            
            // Reload stats
            loadUserStats();
        }
        
        // Load prayer data
        async function loadPrayerData() {
    if (!appState.userId || !appState.coupleId) return;
    
    const container = document.getElementById('prayer-container');
    container.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Loading prayer data...</p></div>';
    
    try {
        const selectedDate = document.getElementById('date-picker').value;
        const isViewingPartner = appState.selectedProfile === 'partner';
        
        // Get couple members
        const coupleSnapshot = await database.ref(`couples/${appState.coupleId}/members`).once('value');
        const members = coupleSnapshot.val() || {};
        
        if (isViewingPartner && Object.keys(members).length < 2) {
            container.innerHTML = '<p>Your partner hasn\'t joined yet. Share your couple code.</p>';
            return;
        }
        
        const userToLoad = isViewingPartner 
            ? Object.keys(members).find(id => id !== appState.userId)
            : appState.userId;

        if (!userToLoad) {
            container.innerHTML = '<p>Partner data not available</p>';
            return;
        }

        // Load prayer data with security rule validation
        const prayerSnapshot = await database.ref(`prayers/${userToLoad}/${selectedDate}`).once('value');
        const prayerData = prayerSnapshot.val() || {};
        
        // Clear container and render cards
        container.innerHTML = '';
        prayers.forEach(prayer => {
            const status = prayerData[prayer.id] || 'pending';
            const card = document.createElement('div');
                                card.className = `prayer-card ${status}`;
                                
                                let statusButtons = '';
                                if (!isViewingPartner) {
                                    statusButtons = `
                                        <div class="prayer-status">
                                            <button class="status-btn completed ${status === 'completed' ? 'active' : ''}" 
                                                    onclick="updatePrayerStatus('${prayer.id}', 'completed')">
                                                Completed
                                            </button>
                                            <button class="status-btn missed ${status === 'missed' ? 'active' : ''}" 
                                                    onclick="updatePrayerStatus('${prayer.id}', 'missed')">
                                                Missed
                                            </button>
                                        </div>
                                    `;
                                }
                                
                                card.innerHTML = `
                                    <div class="prayer-card-content">
                                        <div class="prayer-icon">
                                            <i class="fas ${prayer.icon}"></i>
                                        </div>
                                        <div class="prayer-name">${prayer.name}</div>
                                        <div class="prayer-arabic">${prayer.arabicName}</div>
                                        <div class="prayer-time">${prayer.time}</div>
                                        ${statusButtons}
                                    </div>
                                `;
                                
                                container.appendChild(card);
        });
        
    } catch (error) {
        console.error('Prayer data load error:', error);
        container.innerHTML = `<p>Error loading prayers: ${error.message}</p>`;
    }
}
        
        // Update prayer status
        function updatePrayerStatus(prayerId, status) {
            if (!appState.userId) return;
            
            const selectedDate = document.getElementById('date-picker').value;
            
            // Update prayer status in database
            database.ref('prayers/' + appState.userId + '/' + selectedDate + '/' + prayerId).set(status)
                .then(() => {
                    loadPrayerData(); // Refresh UI
                    showNotification('Prayer status updated!');
                })
                .catch((error) => {
                    showNotification('Error updating prayer: ' + error.message, 'error');
                });
        }
        
        // Send message
        function sendMessage() {
            if (!appState.userId || !appState.coupleId) return;
            
            const messageInput = document.getElementById('message-input');
            const messageText = messageInput.value.trim();
            
            if (!messageText) {
                showNotification('Please enter a message to send', 'error');
                return;
            }
            
            const newMessage = {
                text: messageText,
                userId: appState.userId,
                userName: appState.userName,
                timestamp: new Date().toISOString()
            };
            
            // Add message to database
            database.ref('messages/' + appState.coupleId).push(newMessage)
                .then(() => {
                    messageInput.value = '';
                    loadMessages();
                    showNotification('Message sent!');
                })
                .catch((error) => {
                    showNotification('Error sending message: ' + error.message, 'error');
                });
        }
        
        // Load messages
        function loadMessages() {
            if (!appState.userId || !appState.coupleId) return;
            
            const container = document.getElementById('messages-container');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Loading messages...</p></div>';
            
            // Get messages for the couple
            database.ref('messages/' + appState.coupleId).orderByChild('timestamp').limitToLast(50).once('value')
                .then((snapshot) => {
                    container.innerHTML = '';
                    
                    const messages = [];
                    snapshot.forEach((childSnapshot) => {
                        const message = childSnapshot.val();
                        message.id = childSnapshot.key;
                        messages.push(message);
                    });
                    
                    // Sort messages by timestamp (newest first)
                    messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    if (messages.length === 0) {
                        container.innerHTML = '<p>No messages yet. Be the first to send a loving message!</p>';
                        return;
                    }
                    
                    // Create message elements
                    messages.forEach(message => {
                        const isOwnMessage = message.userId === appState.userId;
                        
                        const messageElement = document.createElement('div');
                        messageElement.className = 'message';
                        
                        const date = new Date(message.timestamp);
                        const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        
                        let deleteButton = '';
                        if (isOwnMessage) {
                            deleteButton = `
                                <div class="message-actions">
                                    <button class="message-delete" onclick="deleteMessage('${message.id}')">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </button>
                                </div>
                            `;
                        }
                        
                        messageElement.innerHTML = `
                            <div class="message-header">
                                <div class="message-sender">
                                    <div class="message-avatar">
                                        <i class="fas fa-${isOwnMessage ? 'user' : 'heart'}"></i>
                                    </div>
                                    <div class="message-name">${message.userName}</div>
                                </div>
                                <div class="message-time">${formattedDate}</div>
                            </div>
                            <div class="message-content">${message.text}</div>
                            ${deleteButton}
                        `;
                        
                        container.appendChild(messageElement);
                    });
                })
                .catch((error) => {
                    container.innerHTML = `<p>Error loading messages: ${error.message}</p>`;
                });
        }
        
        // Delete message
        function deleteMessage(messageId) {
            if (!appState.userId || !appState.coupleId) return;
            
            database.ref('messages/' + appState.coupleId + '/' + messageId).remove()
                .then(() => {
                    loadMessages();
                    showNotification('Message deleted!');
                })
                .catch((error) => {
                    showNotification('Error deleting message: ' + error.message, 'error');
                });
        }
        
        // Load user statistics
        function loadUserStats() {
            if (!appState.userId || !appState.coupleId) return;
            
            const container = document.getElementById('stats-container');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Loading statistics...</p></div>';
            
            const selectedPeriod = parseInt(document.getElementById('stats-period-selector').value);
            const isViewingPartner = appState.selectedStatsProfile === 'partner';
            
            // Get the couple members
            database.ref('couples/' + appState.coupleId + '/members').once('value')
                .then((snapshot) => {
                    const members = snapshot.val();
                    if (!members) {
                        container.innerHTML = '<p>No couple data found.</p>';
                        return;
                    }
                    
                    // Find partner's ID (if there are only 2 members)
                    const memberIds = Object.keys(members);
                    const partnerId = memberIds.find(id => id !== appState.userId);
                    
                    if (isViewingPartner && !partnerId) {
                        container.innerHTML = '<p>Your partner hasn\'t joined yet. Share your couple code.</p>';
                        return;
                    }
                    
                    const userToLoad = isViewingPartner ? partnerId : appState.userId;
                    
                    // Calculate statistics
                    calculateStats(userToLoad, selectedPeriod)
                        .then(stats => {
                            container.innerHTML = '';
                            
                            // Create overall stats card
                            const overallCard = document.createElement('div');
                            overallCard.className = 'stats-card';
                            overallCard.innerHTML = `
                                <div class="stats-title">
                                    <i class="fas fa-chart-pie"></i>
                                    Overall Completion Rate
                                </div>
                                <div class="stats-value">${stats.overall.completionRate}%</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${stats.overall.completionRate}%"></div>
                                </div>
                                <div class="stats-details">
                                    <div class="stats-detail completed">
                                        <div class="stats-label">Completed</div>
                                        <div class="stats-number">${stats.overall.completed}</div>
                                    </div>
                                    <div class="stats-detail missed">
                                        <div class="stats-label">Missed</div>
                                        <div class="stats-number">${stats.overall.missed}</div>
                                    </div>
                                    <div class="stats-detail pending">
                                        <div class="stats-label">Pending</div>
                                        <div class="stats-number">${stats.overall.completionRate}%</div>
                                </div>
                            </div>
                        `;
                        container.appendChild(overallCard);

                        // Create prayer-specific stats cards
                        prayers.forEach(prayer => {
                            const prayerStats = stats.byPrayer[prayer.id];
                            const prayerCard = document.createElement('div');
                            prayerCard.className = 'stats-card';
                            prayerCard.innerHTML = `
                                <div class="stats-title">
                                    <i class="fas ${prayer.icon}"></i>
                                    ${prayer.name} Statistics
                                </div>
                                <div class="stats-value">${prayerStats.completionRate}%</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${prayerStats.completionRate}%"></div>
                                </div>
                                <div class="stats-details">
                                    <div class="stats-detail completed">
                                        <div class="stats-label">Completed</div>
                                        <div class="stats-number">${prayerStats.completed}</div>
                                    </div>
                                    <div class="stats-detail missed">
                                        <div class="stats-label">Missed</div>
                                        <div class="stats-number">${prayerStats.missed}</div>
                                    </div>
                                    <div class="stats-detail pending">
                                        <div class="stats-label">Pending</div>
                                        <div class="stats-number">${prayerStats.pending}</div>
                                    </div>
                                </div>
                            `;
                            container.appendChild(prayerCard);
                        });
                    })
                    .catch((error) => {
                        container.innerHTML = `<p>Error loading statistics: ${error.message}</p>`;
                    });
                })
                .catch((error) => {
                    container.innerHTML = `<p>Error loading couple data: ${error.message}</p>`;
                });
        }

        // Calculate statistics from prayer data
        function calculateStats(userId, days) {
            return new Promise((resolve, reject) => {
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(endDate.getDate() - days);

                const stats = {
                    overall: { completed: 0, missed: 0, pending: 0, total: 0, completionRate: 0 },
                    byPrayer: {}
                };

                // Initialize prayer-specific stats
                prayers.forEach(prayer => {
                    stats.byPrayer[prayer.id] = {
                        completed: 0,
                        missed: 0,
                        pending: 0,
                        total: 0,
                        completionRate: 0
                    };
                });

                // Collect all dates in range
                const datePromises = [];
                const currentDate = new Date(startDate);
                while (currentDate <= endDate) {
                    const dateString = currentDate.toISOString().split('T')[0];
                    datePromises.push(
                        database.ref(`prayers/${userId}/${dateString}`).once('value')
                    );
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                Promise.all(datePromises)
                    .then(snapshots => {
                        snapshots.forEach(snapshot => {
                            const prayerData = snapshot.val() || {};
                            prayers.forEach(prayer => {
                                const status = prayerData[prayer.id] || 'pending';
                                
                                stats.overall.total++;
                                stats.byPrayer[prayer.id].total++;

                                if (status === 'completed') {
                                    stats.overall.completed++;
                                    stats.byPrayer[prayer.id].completed++;
                                } else if (status === 'missed') {
                                    stats.overall.missed++;
                                    stats.byPrayer[prayer.id].missed++;
                                } else {
                                    stats.overall.pending++;
                                    stats.byPrayer[prayer.id].pending++;
                                }
                            });
                        });

                        // Calculate completion rates
                        stats.overall.completionRate = stats.overall.total > 0 
                            ? Math.round((stats.overall.completed / stats.overall.total) * 100)
                            : 0;

                        prayers.forEach(prayer => {
                            const prayerStats = stats.byPrayer[prayer.id];
                            prayerStats.completionRate = prayerStats.total > 0 
                                ? Math.round((prayerStats.completed / prayerStats.total) * 100)
                                : 0;
                        });

                        resolve(stats);
                    })
                    .catch(error => reject(error));
            });
        }

        // Save user settings
        function saveSettings() {
            const newName = document.getElementById('user-name-input').value;
            const newPartnerName = document.getElementById('partner-name-input').value;

            database.ref('users/' + appState.userId).update({
                name: newName,
                partnerName: newPartnerName
            })
            .then(() => {
                appState.userName = newName;
                appState.partnerName = newPartnerName;
                updateProfileNames();
                showNotification('Settings saved successfully!');
            })
            .catch(error => {
                showNotification('Error saving settings: ' + error.message, 'error');
            });
        }

        // Cancel settings changes
        function cancelSettings() {
            document.getElementById('user-name-input').value = appState.userName;
            document.getElementById('partner-name-input').value = appState.partnerName;
        }

        // Update profile names across the UI
        function updateProfileNames() {
            document.getElementById('current-user-name').textContent = appState.userName;
            document.getElementById('user-profile-name').textContent = appState.userName;
            document.getElementById('partner-profile-name').textContent = appState.partnerName;
            document.getElementById('stats-user-name').textContent = appState.userName;
            document.getElementById('stats-partner-name').textContent = appState.partnerName;
        }

        // Show notification message
        function showNotification(message, type = 'success') {
            notificationEl.className = `notification ${type} show`;
            notificationEl.querySelector('i').className = `fas ${
                type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'
            }`;
            notificationText.textContent = message;
            
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>